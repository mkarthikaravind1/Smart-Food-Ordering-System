<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Orders - BiteBurst</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 70px;
            font-family: 'Poppins', sans-serif;
        }

        .order-card {
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .order-items {
            list-style: none;
            padding-left: 0;
        }

        .order-items li {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .order-items li img {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            margin-right: 10px;
        }

        .item-details {
            display: flex;
            flex-direction: column;
        }

        .item-details span.restaurant {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .repeat-btn, .remove-btn {
            margin-top: 10px;
            margin-right: 5px;
        }

        .navbar-nav .nav-link {
            font-weight: 500;
            color: #fff;
            transition: 0.3s;
        }

        .navbar-nav .nav-link:hover {
            color: #ffc107;
        }

        .btn-group {
            display: flex;
            justify-content: flex-end;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top px-3">
        <a class="navbar-brand fw-bold" href="index.html">üçî BiteBurst</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="menu.html">Menu</a></li>
                <li class="nav-item"><a class="nav-link" href="cart.html">Cart (<span id="cart-count">0</span>)</a></li>
            
            </ul>
        </div>
    </nav>

    <div class="container my-4">
        <h2 class="mb-4">Your Orders</h2>
        <div id="ordersContainer"></div>
    </div>

    <script>
        const cartCountEl = document.getElementById("cart-count");
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        cartCountEl.innerText = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);

        const ordersContainer = document.getElementById("ordersContainer");
        let orders = JSON.parse(localStorage.getItem("orders")) || [];

        function renderOrders() {
            ordersContainer.innerHTML = "";
            if(orders.length === 0){
                ordersContainer.innerHTML = "<p class='text-muted'>You have no orders yet.</p>";
                return;
            }

            orders.forEach((order, index) => {
                const orderCard = document.createElement("div");
                orderCard.className = "order-card";

                let itemsHTML = "";
                order.items.forEach(item => {
                    itemsHTML += `<li>
                                    <img src="${item.image}" alt="${item.item}">
                                    <div class="item-details">
                                        <span class="restaurant">${item.restaurant}</span>
                                        <span>${item.item} (${item.quantity || 1})</span>
                                    </div>
                                    <span>‚Çπ${parseInt(item.price.replace(/[^\d]/g,"")) * (item.quantity || 1)}</span>
                                  </li>`;
                });

                const totalAmount = order.items.reduce((sum, item) => {
                    return sum + (parseInt(item.price.replace(/[^\d]/g,"")) * (item.quantity || 1));
                }, 0);

                orderCard.innerHTML = `
                    <div class="order-header">
                        <span>Order ID: ${order.id}</span>
                        <span>Date: ${order.date}</span>
                    </div>
                    <ul class="order-items">
                        ${itemsHTML}
                    </ul>
                    <div class="order-header">
                        <span>Total:</span>
                        <span>‚Çπ${totalAmount}</span>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-primary repeat-btn">Repeat Order</button>
                        <button class="btn btn-sm btn-danger remove-btn">Remove Order</button>
                    </div>
                `;

                // Repeat Order
                orderCard.querySelector(".repeat-btn").addEventListener("click", () => {
                    let currentCart = JSON.parse(localStorage.getItem("cart")) || [];
                    order.items.forEach(item => {
                        const existing = currentCart.find(i => i.item === item.item && i.restaurant === item.restaurant);
                        if(existing){
                            existing.quantity = (existing.quantity || 1) + (item.quantity || 1);
                        } else {
                            currentCart.push({...item});
                        }
                    });
                    localStorage.setItem("cart", JSON.stringify(currentCart));
                    alert("Order added to cart!");
                    cartCountEl.innerText = currentCart.reduce((sum, i) => sum + (i.quantity || 1), 0);
                    window.location.href = "cart.html";
                });

                // Remove Order
                orderCard.querySelector(".remove-btn").addEventListener("click", () => {
                    if(confirm("Are you sure you want to remove this order?")){
                        orders.splice(index, 1);
                        localStorage.setItem("orders", JSON.stringify(orders));
                        renderOrders();
                        alert("Order removed successfully!");
                    }
                });

                ordersContainer.appendChild(orderCard);
            });
        }

        renderOrders();
    </script>
</body>
</html>
